{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LabEQuality</title>
  <link rel="shortcut icon" type="image/png" href="{% static '/images/favicon.ico' %}"/>

  <!-- Preinit de tema ANTES de cualquier CSS para evitar FOUC y fijar variables -->
  <script>
    (function () {
      var saved = localStorage.getItem('bs-theme');
      var mode = (saved === 'dark' || saved === 'light') ? saved : 'light';
      var root = document.documentElement; // <html>
      // Limpiar artefactos de otros toggles si existieran
      root.removeAttribute('data-theme');
      root.classList.remove('dark');
      // Bootstrap 5.3 color modes en <html>
      root.setAttribute('data-bs-theme', mode);
      // Tailwind dark: estrategia por clase en <html>
      if (mode === 'dark') root.classList.add('dark');
    })();
  </script> <!-- data-bs-theme en <html> es la forma recomendada por Bootstrap 5.3 -->

  {% load django_bootstrap5 %}
  {% bootstrap_css %}
  {% bootstrap_javascript %}
  {% block customcss %}{% endblock %}

  <!-- CSS de la app -->
  <link href="{% static 'css/app.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'css/icons.min.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'css/nice-select2.css' %}" rel="stylesheet" type="text/css">

  <!-- Controlador de tema y configuración (defer para ejecutar tras parsear HTML) -->
  <script src="{% static 'js/config.js' %}" defer></script> <!-- defer garantiza DOM listo para enlazar el botón del topbar -->

  <!-- Tu CSS personalizado SIEMPRE después de Bootstrap -->
  <link rel="stylesheet" href="{% static 'css/custom-styles.css' %}">
</head>

<body>
  <div class="flex wrapper">
    {% include 'sidebar.html' %}

    <div class="page-content">

      <!-- Topbar Start -->
      {% include 'topbar.html' %}
      <!-- Topbar End -->

      <!-- Topbar Search Modal -->
      {% include 'topbarsearch.html' %}
      <!-- Topbar Search Modal End -->

      <!-- Main -->
      <main class="flex-grow">
        {% block content %}{% endblock %}
      </main>
      <!-- Main End -->

      <!-- Footer Start -->
      {% include 'footer.html' %}
      <!-- Footer End -->

    </div>
  </div>

  <!-- Back to Top Button -->
  <button data-toggle="back-to-top" class="fixed hidden h-10 w-10 items-center justify-center rounded-full z-10 bottom-20 end-14 p-2.5 bg-primary cursor-pointer shadow-lg text-white">
    <i class="mgc_arrow_up_line text-lg"></i>
  </button>

  <!-- Plugin Js -->
  <script src="{% static 'libs/simplebar/simplebar.min.js' %}"></script>
  <script src="{% static 'libs/feather-icons/feather.min.js' %}"></script>
  <script src="{% static 'libs/@frostui/tailwindcss/frostui.js' %}"></script>
  <script src="{% static 'libs/nice-select2/js/nice-select2.js' %}"></script>

  <!-- App Js -->
  <script src="{% static 'js/app.js' %}"></script>

  <!-- Apexcharts js -->
  <script src="{% static 'libs/apexcharts/apexcharts.min.js' %}"></script>

  <!-- Dashboard Project Page js -->
  <!-- <script src="{% static 'js/pages/dashboard.js' %}"></script> -->

  {% block customscripts %}{% endblock %}
</body>

</html>
